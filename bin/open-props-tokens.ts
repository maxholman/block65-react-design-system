/* eslint-disable no-restricted-syntax */
import { camelCase } from 'change-case';
import tokens from 'open-props/open-props.tokens.json' with { type: 'json' };
import { Project, VariableDeclarationKind } from 'ts-morph';

const project = new Project();
const sourceFile = project.createSourceFile('.fake.ts');

// so that blue1 comes before blue10
const collator = new Intl.Collator([], { numeric: true });

const groupedTokens = Object.groupBy(Object.entries(tokens), ([, token]) =>
  '$type' in token ? token.$type : 'other',
);

sourceFile.addStatements([
  `/**
   * This file was auto generated by @block65/react-design-system
   *
   * Original tokens from the open-props project by @argyleink
   * https://github.com/argyleink/open-props
   *
   * WARN: Do not edit directly.
   *
   * Generated on ${new Date().toISOString()} by ${JSON.stringify(process.env.USER)}
   *
  */`,
]);

for (const [group, tokenGroup] of Object.entries(groupedTokens)) {
  sourceFile.addStatements(['', `// Token Group: ${JSON.stringify(group)}`]);

  if (tokenGroup) {
    tokenGroup.sort(([a], [b]) => collator.compare(a, b));

    for (const [cssVarName, token] of tokenGroup) {
      sourceFile.addVariableStatement({
        declarationKind: VariableDeclarationKind.Const,
        isExported: true,
        docs: [`Source CSS var: ${cssVarName}`],
        declarations: [
          {
            name: camelCase(cssVarName, {
              mergeAmbiguousCharacters: true,
            }),
            initializer: JSON.stringify(
              typeof token.$value === 'string'
                ? token.$value.trim()
                : token.$value,
              null,
              2,
            ),
          },
        ],
      });
    }
  }
}

sourceFile.formatText();
process.stdout.write(`${sourceFile.getFullText()}\n`);
